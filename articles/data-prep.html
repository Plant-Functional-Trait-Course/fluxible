<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Preparing the data for fluxible • fluxible</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Preparing the data for fluxible">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fluxible</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/fluxible.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/data-prep.html">Preparing the data for fluxible</a></li>
    <li><a class="dropdown-item" href="../articles/two-gases.html">Working with two gases measured simultaneously</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Plant-Functional-Trait-Course/fluxible/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Preparing the data for fluxible</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Plant-Functional-Trait-Course/fluxible/blob/main/vignettes/data-prep.Rmd" class="external-link"><code>vignettes/data-prep.Rmd</code></a></small>
      <div class="d-none name"><code>data-prep.Rmd</code></div>
    </div>

    
    
<p>Loggers and field equipement provide many different datasets format.
The <code><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">readr::read_delim</a></code> <span class="citation">(Wickham
<em>et al.</em>, 2024)</span> function works perfectly in most cases,
given that the data are in a delimited file.</p>
<p>We provide here examples on how to use <code>read_delim</code> to
prepare your raw data files for the Fluxible R package. For users of
Li-COR instruments, the <a href="https://joXXXX.github.io/licoread/index.html" class="external-link">licoread R
package</a>, developped in collaboration with Li-COR, is designed to
read 82z and 81x files and import them as fluxible-friendly objets.
<!-- For users of LI-COR instruments, we present at the end of this section the Licoread R package [@XXXXLicoreadReadsRaw2025], to read specific LI-COR formats (82z and 81x). --></p>
<div class="section level2">
<h2 id="checklists-for-inputs">Checklists for inputs<a class="anchor" aria-label="anchor" href="#checklists-for-inputs"></a>
</h2>
<p>The first function to use when processing ecosystem gas fluxes data
with Fluxible is <code>flux_match</code>, which requires two inputs:
<code>row_conc</code> and <code>field_record</code>. The columns in both
files do not require specific names, and those will be kept during the
entire workflow. We however advise that those names do not contain
spaces or special characters.</p>
<div class="section level3">
<h3 id="input-raw_conc">Input <code>raw_conc</code><a class="anchor" aria-label="anchor" href="#input-raw_conc"></a>
</h3>
<p>The input <code>raw_conc</code> is the file with the gas
concentration measured over time, typically the file exported by the
logger or instrument, and needs to fulfill the following criteria:</p>
<!-- - Columns that will be used in Fluxible do not contain space or special characters -->
<ul>
<li>A column with gas concentration as numeric values</li>
<li>A column in datetime format (<code>yyyy-mm-dd hh:mm:ss</code>)
corresponding to each data point of gas concentration</li>
</ul>
</div>
<div class="section level3">
<h3 id="input-field_record">Input <code>field_record</code><a class="anchor" aria-label="anchor" href="#input-field_record"></a>
</h3>
<p>The input <code>field_record</code> is the metadata file that
contains the information of when which sample or plot was measured. It
can also provide other meta data, such as campaign, site, type of
measurement, etc. This file should contain:</p>
<!-- - Colum that will be used in Fluxible do not contain space or special characters -->
<ul>
<li>A column indicating the start of each measurement in datetime format
(<code>yyyy-mm-dd hh:mm:ss</code>)</li>
<li>If the length of the measurements is not a constant: a column
containing the end of each measurement in datetime format
(<code>yyyy-mm-dd hh:mm:ss</code>)</li>
</ul>
</div>
<div class="section level3">
<h3 id="by-passing-flux_match">By-passing <code>flux_match</code><a class="anchor" aria-label="anchor" href="#by-passing-flux_match"></a>
</h3>
<p>The <code>flux_match</code> function only intends to attribute a
unique <code>flux_id</code> to each measurement and slice out recordings
in between measurements. Depending on your setup, this step might not be
necessary. The <code>flux_fitting</code> function is the step after
<code>flux_match</code> and its input should check the following
points:</p>
<!-- - Columns that will be used in Fluxible do not contain space or special characters -->
<ul>
<li>A gas concentration column as numeric</li>
<li>A column in datetime format (<code>yyyy-mm-dd hh:mm:ss</code>)
corresponding to each gas concentration data points</li>
<li>A column with a unique ID for each measurement</li>
<li>A column indicating the start of each measurement in datetime format
(<code>yyyy-mm-dd hh:mm:ss</code>)</li>
<li>A column indicating the end of each measurement in datetime format
(<code>yyyy-mm-dd hh:mm:ss</code>)</li>
</ul>
</div>
<div class="section level3">
<h3 id="defining-your-dataset">Defining your dataset<a class="anchor" aria-label="anchor" href="#defining-your-dataset"></a>
</h3>
<p>Fluxible treats the entire dataset homogeneously in terms of choice
of model to fit the data and quality control. This is because every step
in this process has a risk of adding a bias to the final data (for
example, a linear fit tends to under estimate fluxes while an
exponential one tends to over estimate fluxes). By treating the data
homogeneously, the bias are consistent and therefore will affect further
analysis less.
<!-- Homogeneous treatement of the dataset also means that the dataset should be carefully defined, as to avoid introducing bias (fitting all treatment A with a linear model and all treatment B with an exponential model might show that B has higher fluxes than than A, because of the way those models tend to under and over estimate fluxes). -->
Measurements done under similar conditions and with the same equipment
should ideally be processed together.</p>
<p>Note that the “flux after flux” approach, treating each measurement
individually in terms of fit, cut and quality control, is also possible
(but this is not what Fluxible is optimised for!). It would require
looping the <code>flux_fitting</code> and <code>flux_quality</code>
(optionally <code>flux_plot</code> too for visualization) functions on
each flux ID with a prompt asking for the arguments.</p>
</div>
</div>
<div class="section level2">
<h2 id="importing-a-single-file">Importing a single file<a class="anchor" aria-label="anchor" href="#importing-a-single-file"></a>
</h2>
<p>In this example we will import the file <code>26124054001.#00</code>,
which is a text file extracted from a Squirrel Data Logger 2010 Series
(Grant Instruments) through SquirrelView software. The first thing to do
when importing a file with <code>read_delim</code> is to open the file
in a text editor to look at its structure.</p>
<div class="float" id="fig-header">
<img src="squirrel_head.png" alt="Screenshot of the file 26124054001.#00 in a text editor. We can see that the 25th first rows do not need to be imported, and that it is comma separated with a dot as a decimal point."><div class="figcaption">Screenshot of the file
<code>26124054001.#00</code> in a text editor. We can see that the 25th
first rows do not need to be imported, and that it is comma separated
with a dot as a decimal point.</div>
</div>
<p><br>
We will read the file with <code>read_delim</code>, and then use
<code>rename</code> and <code>mutate</code> <span class="citation">(from
the <code>dplyr</code> package ; Wickham <em>et al.</em>, 2023)</span>
to transform the columns into what we want, and <code>dmy_hms</code>
from the <code>lubridate</code> package <span class="citation">(Grolemund and Wickham, 2011)</span> to get our
datetime column in the right format:</p>
<!-- [^2]: both `dplyr` and `readr` are part of the `tidyverse` [@tidyverse2019]. -->
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co"># readr, dplyr and lubridate are part of tidyverse</span></span>
<span></span>
<span><span class="va">raw_conc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_delim</a></span><span class="op">(</span></span>
<span>  <span class="st">"ex_data/26124054001.#00"</span>,</span>
<span>  delim <span class="op">=</span> <span class="st">","</span>, <span class="co"># our file is comma separated</span></span>
<span>  skip <span class="op">=</span> <span class="fl">25</span> <span class="co"># the first 25 rows are logger infos that we do not want to keep</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><code>raw_conc</code> structure:</p>
<pre><code><span><span class="co">#&gt; spc_tbl_ [17 × 7] (S3: spec_tbl_df/tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ Date          : chr [1:17] "26.06.2020" "26.06.2020" "26.06.2020"..</span></span>
<span><span class="co">#&gt;  $ Time          : 'hms' num [1:17] 12:40:56 12:40:57 12:40:58 12:40..</span></span>
<span><span class="co">#&gt;  $ Type          : chr [1:17] "Interval" "Interval" "Interval" "Int"..</span></span>
<span><span class="co">#&gt;  $ CO2 (V)       : num [1:17] 2.08 2.09 2.08 2.08 2.06 ...</span></span>
<span><span class="co">#&gt;  $ H2O (V)       : num [1:17] 4e-04 4e-04 4e-04 4e-04 4e-04 4e-04 4e..</span></span>
<span><span class="co">#&gt;  $ CO2_calc (ppm): num [1:17] 416 418 416 416 412 ...</span></span>
<span><span class="co">#&gt;  $ H2O_calc (ppt): num [1:17] 0.007 0.008 0.007 0.008 0.008 0.007 0...</span></span></code></pre>
<p>Not too bad… but we are not quite there yet:</p>
<ul>
<li>Some column names contain space</li>
<li>Some columns are not needed, removing them will make things easier
later on: <code>Type</code> (nothing to do with the type of measurement,
something from the logger), <code>CO2 (V)</code>, <code>H2O (V)</code>
(those two are the voltage input to the logger, not needed), and
<code>H2O_calc (ppt)</code> (that one was not calibrated for this
campaign so better remove it to avoid confusion)</li>
<li>The <code>Date</code> and <code>Time</code> columns should be united
in one and transformed in <code>yyyy-mm-dd hh:mm:ss</code> format</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">raw_conc</span> <span class="op">&lt;-</span> <span class="va">raw_conc</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>    co2_conc <span class="op">=</span> <span class="st">"CO2_calc (ppm)"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    datetime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Time</span><span class="op">)</span>, <span class="co"># we paste date and time together</span></span>
<span>    datetime <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">dmy_hms</a></span><span class="op">(</span><span class="va">datetime</span><span class="op">)</span> <span class="co"># datetime instead of character</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">datetime</span>, <span class="va">co2_conc</span><span class="op">)</span></span></code></pre></div>
<p>Et voilà:</p>
<pre><code><span><span class="co">#&gt; tibble [17 × 2] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ datetime: POSIXct[1:17], format: "2020-06-26 12:40:56" ...</span></span>
<span><span class="co">#&gt;  $ co2_conc: num [1:17] 416 418 416 416 412 ...</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="importing-multiple-files">Importing multiple files<a class="anchor" aria-label="anchor" href="#importing-multiple-files"></a>
</h2>
<p>Quite often a field season will result in several files. In this
example we will read all the files in “ex_data/” that contain “CO2” in
their names.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">raw_conc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span> <span class="co"># list the files</span></span>
<span>  <span class="st">"ex_data"</span>, <span class="co"># at location "ex_data"</span></span>
<span>  full.names <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  pattern <span class="op">=</span> <span class="st">"*CO2*"</span> <span class="co"># that contains "CO2" in their name</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_dfr</a></span><span class="op">(</span></span>
<span>    <span class="va">read_csv</span>, <span class="co"># we map read_csv on all the files</span></span>
<span>    na <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#N/A"</span>, <span class="st">"Over"</span><span class="op">)</span> <span class="co"># "#N/A" and Over should be treated as NA</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>    conc <span class="op">=</span> <span class="st">"CO2 (ppm)"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    datetime <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">dmy_hms</a></span><span class="op">(</span><span class="va">`Date/Time`</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">datetime</span>, <span class="va">conc</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-one-file-per-flux-approach">The one file per flux approach<a class="anchor" aria-label="anchor" href="#the-one-file-per-flux-approach"></a>
</h2>
<p>Fluxible is designed to process data that were measured continuously
(in a single or several files) and a <code>field_record</code> that
records what was measured when. Another strategy while measuring gas
fluxes on the field is to create a new file for each measurement, with
the file name as the flux ID. The approach is similar to reading
multiple files, except we add a column with the file name, and can then
by-pass <code>flux_match</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">raw_conc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span> <span class="co">#listing all the files</span></span>
<span>  <span class="st">"ex_data/field_campaign"</span>, <span class="co"># at location "ex_data/field_campaign"</span></span>
<span>  full.names <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_dfr</a></span><span class="op">(</span> <span class="co"># we map read_tsv on all the files</span></span>
<span>    <span class="co"># read_tsv is the version of read_delim for tab separated value files</span></span>
<span>    <span class="va">read_tsv</span>,</span>
<span>    skip <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    <span class="co"># creates a column with the filename, that we can use as flux ID</span></span>
<span>    id <span class="op">=</span> <span class="st">"filename"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span> <span class="co"># a bit of renaming to make the columns more practical</span></span>
<span>    co2_conc <span class="op">=</span> <span class="st">"CO2 (umol/mol)"</span>,</span>
<span>    h2o_conc <span class="op">=</span> <span class="st">"H2O (mmol/mol)"</span>,</span>
<span>    air_temp <span class="op">=</span> <span class="st">"Temperature (C)"</span>,</span>
<span>    pressure <span class="op">=</span> <span class="st">"Pressure (kPa)"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    datetime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Time</span><span class="op">)</span>,</span>
<span>    <span class="co"># we get rid of the milliseconds</span></span>
<span>    datetime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="va">datetime</span>, format<span class="op">=</span><span class="st">"%Y-%m-%d %H:%M:%OS"</span><span class="op">)</span>,</span>
<span>    pressure <span class="op">=</span> <span class="va">pressure</span> <span class="op">/</span> <span class="fl">101.325</span>, <span class="co"># conversion from kPa to atm</span></span>
<span>    filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">filename</span><span class="op">)</span> <span class="co"># removing folder names</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">datetime</span>, <span class="va">co2_conc</span>, <span class="va">h2o_conc</span>, <span class="va">air_temp</span>, <span class="va">pressure</span>, <span class="va">filename</span><span class="op">)</span></span></code></pre></div>
<p><code>raw_conc</code> structure:</p>
<pre><code><span><span class="co">#&gt; tibble [18 × 6] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ datetime: POSIXct[1:18], format: "2023-12-14 10:57:01" ...</span></span>
<span><span class="co">#&gt;  $ co2_conc: num [1:18] 416 407 404 421 411 ...</span></span>
<span><span class="co">#&gt;  $ h2o_conc: num [1:18] 22.7 22.5 23 22.6 22.8 ...</span></span>
<span><span class="co">#&gt;  $ air_temp: num [1:18] 22.4 22.4 22.4 22.3 22.3 ...</span></span>
<span><span class="co">#&gt;  $ pressure: num [1:18] 0.79 0.791 0.79 0.79 0.791 ...</span></span>
<span><span class="co">#&gt;  $ filename: chr [1:18] "1_2000_east_1_day_a-2023-12-14T105700.txt""..</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="the-tricky-one">The tricky one<a class="anchor" aria-label="anchor" href="#the-tricky-one"></a>
</h2>
<!-- (should I keept that?) -->
<p>What happens when you extract a logger file in csv using a computer
with settings using comma as a decimal point (which is quite standard in
Europe)? Well, you get a comma separated values (csv) file, with
decimals separated by… comma.</p>
<p>Ideally the file should have been extracted in European csv, which
means comma for decimals and semi-colon as column separator. But here we
are.</p>
<div class="float" id="fig-tricky">
<img src="tricky.png" alt="Screenshot of the file 011023001.#01 opened in a text editor. We can see that it is comma separated, but that the decimal point is also a comma. Additionally, we see that some variables were measured only every 10 seconds, meaning that each row has a different number of commas… Gnnnnnnn"><div class="figcaption">Screenshot of the file
<code>011023001.#01</code> opened in a text editor. We can see that it
is comma separated, but that the decimal point is also a comma.
Additionally, we see that some variables were measured only every 10
seconds, meaning that each row has a different number of commas…
Gnnnnnnn</div>
</div>
<p><br>
Let’s try the usual way first:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">raw_conc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span> <span class="co"># read_csv is the same as read_delim(delim = ",")</span></span>
<span>  <span class="st">"ex_data/011023001.#01"</span>,</span>
<span>  col_types <span class="op">=</span> <span class="st">"Tcdddddd"</span>,</span>
<span>  na <span class="op">=</span> <span class="st">"#N/A"</span> <span class="co"># we tell read_csv what NA look like in that file</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; spc_tbl_ [101 × 8] (S3: spec_tbl_df/tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ Date/Time     : POSIXct[1:101], format: NA ...</span></span>
<span><span class="co">#&gt;  $ Type          : chr [1:101] "Interval" "Interval" "Interval" "In"..</span></span>
<span><span class="co">#&gt;  $ CO2_input (V) : num [1:101] 2 2 2 2 2 2 2 2 2 2 ...</span></span>
<span><span class="co">#&gt;  $ PAR_input (mV): num [1:101] 28 28 28 35 31 23 58 35 7 3 ...</span></span>
<span><span class="co">#&gt;  $ Temp_air ('C) : num [1:101] 0 NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ Temp_soil ('C): num [1:101] 80663 NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ CO2 (ppm)     : num [1:101] 12 NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ PAR (umolsm2) : num [1:101] NA NA NA NA NA NA NA NA NA NA ...</span></span></code></pre>
<p>It took the column names right, but then of course interpreted all
comma as separators, and made a mess. Let’s see if we can skipped the
header and then assemble the columns with left and right side of the
decimal point:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">raw_conc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span></span>
<span>  <span class="st">"ex_data/011023001.#01"</span>,</span>
<span>  skip <span class="op">=</span> <span class="fl">1</span>, <span class="co"># this time we skip the row with the column names</span></span>
<span>  col_names <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># we tell read_csv that column names are not provided</span></span>
<span>  na <span class="op">=</span> <span class="st">"#N/A"</span> <span class="co"># we tell read_csv what NA looks like in that file</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; spc_tbl_ [101 × 14] (S3: spec_tbl_df/tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ X1 : chr [1:101] "01.10.2023 11:23:40" "01.10.2023 11:23:41" "01"..</span></span>
<span><span class="co">#&gt;  $ X2 : chr [1:101] "Interval" "Interval" "Interval" "Interval" ...</span></span>
<span><span class="co">#&gt;  $ X3 : num [1:101] 2 2 2 2 2 2 2 2 2 2 ...</span></span>
<span><span class="co">#&gt;  $ X4 : chr [1:101] "0028" "0028" "0028" "0035" ...</span></span>
<span><span class="co">#&gt;  $ X5 : num [1:101] 0 NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ X6 : chr [1:101] "080663" NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ X7 : num [1:101] 12 NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ X8 : chr [1:101] "00" "400" "400" "400" ...</span></span>
<span><span class="co">#&gt;  $ X9 : chr [1:101] "10" "56" "55" "70" ...</span></span>
<span><span class="co">#&gt;  $ X10: num [1:101] 81 NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ X11: num [1:101] 400 NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ X12: chr [1:101] "55" "" "" "" ...</span></span>
<span><span class="co">#&gt;  $ X13: num [1:101] 20 NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ X14: chr [1:101] "60" "" "" "" ...</span></span></code></pre>
<p>The problem now is that CO<sub>2</sub> concentration was measured
every second (with a comma!), while other variable were measured every
10 seconds. That means every 10th row has 14 comma separated elements,
while the others have only 10. Uhhhhhhhhh</p>
<p>At this point, you might want to get the field computer out again and
re extract your raw file with a European csv output, or anything that is
not comma separated, or set the decimal point as a… point. But for the
sake of it, let’s pretend that it is not an option and solve that issue
in R:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># we read each row of our file as an element of a list</span></span>
<span><span class="va">lines</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="st">"ex_data/011023001.#01"</span><span class="op">)</span></span>
<span><span class="va">lines</span> <span class="op">&lt;-</span> <span class="va">lines</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="co"># removing the first element with the column names</span></span>
<span></span>
<span><span class="co"># we first deal with the elements where we have those environmental data</span></span>
<span><span class="co"># that were measured every 10 seconds</span></span>
<span><span class="va">linesenv</span> <span class="op">&lt;-</span> <span class="va">lines</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">lines</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">env_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/textconnections.html" class="external-link">textConnection</a></span><span class="op">(</span><span class="va">linesenv</span><span class="op">)</span>, <span class="co"># we read the list into a csv</span></span>
<span>  header <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># there is no header</span></span>
<span>  colClasses <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"character"</span>, <span class="fl">14</span><span class="op">)</span></span>
<span>  <span class="co"># specifying that those columns are character is important</span></span>
<span>  <span class="co"># if read as integer, 06 becomes 6, and when putting columns together,</span></span>
<span>  <span class="co"># 400.06 will be read as 400.6, which is wrong</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">env_df</span> <span class="op">&lt;-</span> <span class="va">env_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    datetime <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">dmy_hms</a></span><span class="op">(</span><span class="va">V1</span><span class="op">)</span>,</span>
<span>    temp_air <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>      <span class="va">V7</span>, <span class="co"># V7 contains the left side of the decimal point</span></span>
<span>      <span class="va">V8</span>, <span class="co"># V8 the right side</span></span>
<span>      sep <span class="op">=</span> <span class="st">"."</span> <span class="co"># this time we put it in american format</span></span>
<span>    <span class="op">)</span>,</span>
<span>    temp_air <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="va">temp_air</span><span class="op">)</span>, <span class="co"># now we can make it a double</span></span>
<span>    temp_soil <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">V9</span>, <span class="va">V10</span>, sep <span class="op">=</span> <span class="st">"."</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    co2_conc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">V11</span>, <span class="va">V12</span>, sep <span class="op">=</span> <span class="st">"."</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    PAR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">V13</span>, <span class="va">V14</span>, sep <span class="op">=</span> <span class="st">"."</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">datetime</span>, <span class="va">temp_air</span>, <span class="va">temp_soil</span>, <span class="va">co2_conc</span>, <span class="va">PAR</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># now we do the same with the other elements of the list</span></span>
<span><span class="va">lines_other</span> <span class="op">&lt;-</span> <span class="va">lines</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">lines</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">other_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/textconnections.html" class="external-link">textConnection</a></span><span class="op">(</span><span class="va">lines_other</span><span class="op">)</span>,</span>
<span>  header <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  colClasses <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"character"</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">other_df</span> <span class="op">&lt;-</span> <span class="va">other_df</span>  <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    datetime <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">dmy_hms</a></span><span class="op">(</span><span class="va">V1</span><span class="op">)</span>,</span>
<span>    co2_conc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">V8</span>, <span class="va">V9</span>, sep <span class="op">=</span> <span class="st">"."</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">datetime</span>, <span class="va">co2_conc</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># and finally we do a full join with both</span></span>
<span><span class="va">conc_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">env_df</span>, <span class="va">other_df</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">datetime</span><span class="op">)</span> <span class="co"># I like my dataframes in chronological order</span></span></code></pre></div>
<p>Et voilà:</p>
<pre><code><span><span class="co">#&gt; 'data.frame':    101 obs. of  5 variables:</span></span>
<span><span class="co">#&gt;  $ datetime : POSIXct, format: "2023-10-01 11:23:40" ...</span></span>
<span><span class="co">#&gt;  $ temp_air : num  12 NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ temp_soil: num  10.8 NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ co2_conc : num  401 401 401 401 401 ...</span></span>
<span><span class="co">#&gt;  $ PAR      : num  20.6 NA NA NA NA NA NA NA NA NA ...</span></span></code></pre>
<p>That was a strange mix of tidyverse and base R, and I would
definitely try to do some plots to check if the data are making sense
(number around 420 are most likely CO<sub>2</sub> concentration, those
between 5 and 20 probably temperature, and soil temperature should be
lower than air temperature). But it worked…</p>
<div class="section level4 unnumbered">
<h4 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h4>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0" line-spacing="2">
<div id="ref-lubridate2011" class="csl-entry">
Grolemund, G. and Wickham, H. (2011), <span>“Dates and times made easy
with <span class="nocase">lubridate</span>”</span>, <em>Journal of
Statistical Software</em>, Vol. 40 No. 3, pp. 1–25.
</div>
<div id="ref-dplyr2023" class="csl-entry">
Wickham, H., François, R., Henry, L., Müller, K. and Vaughan, D. (2023),
<em>Dplyr: A Grammar of Data Manipulation</em>, Manual,.
</div>
<div id="ref-readr2024" class="csl-entry">
Wickham, H., Hester, J. and Bryan, J. (2024), <em>Readr:
<span>Read</span> Rectangular Text Data</em>, Manual,.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by XXXX XXXX, XXXX XXXX XXXX.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
